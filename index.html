<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Grammar Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Tailwind Stone) with Teal accent -->
    <!-- Application Structure Plan: The application now features a "Home Page" as its initial view, presenting a grid of buttons. Each button represents a distinct quiz set, dynamically generated from a central data structure. Clicking a button transitions to the "Quiz Container" view, which maintains the single-question-at-a-time focus, progress tracking, and immediate feedback. Upon quiz completion, the "Results Container" is shown. Navigation between these views is handled via dedicated buttons (e.g., "Back to Home", "Restart Quiz"). This structure provides a clear entry point for users to select their desired quiz content and enhances the application's scalability for future quiz additions. -->
    <!-- Visualization & Content Choices: The Home Page uses a simple grid of styled HTML buttons to allow selection of quiz sets (Goal: Organize/Navigate, Interaction: Click). Questions are presented as text with clickable buttons for options (Goal: Test Knowledge, Interaction: Click). Feedback is a dynamic text block (Goal: Inform, Interaction: Appears on click). Final score is visualized with a Chart.js Donut Chart (Goal: Compare/Summarize, Viz: Donut Chart) showing correct vs. incorrect answers for a quick, impactful summary of performance. All diagrams/visuals are HTML/CSS/Canvas based, adhering to the NO SVG/Mermaid constraint. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 280px;
            margin-left: auto;
            margin-right: auto;
            height: 280px;
            max-height: 280px;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        
        <div id="home-page-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg transition-opacity duration-500">
            <h2 class="text-2xl sm:text-3xl font-bold text-stone-800 mb-6 text-center">Select a Quiz Set</h2>
            <div id="quiz-set-buttons" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Quiz set buttons will be dynamically inserted here -->
            </div>
        </div>

        <div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg transition-opacity duration-500 hidden">
            <header class="mb-6">
                <div class="flex justify-between items-center mb-2 text-sm text-stone-500">
                    <span>Progress</span>
                    <span id="progress-text">Question 1 / 20</span>
                </div>
                <div class="w-full bg-stone-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-teal-500 h-2.5 rounded-full transition-all duration-500" style="width: 5%"></div>
                </div>
            </header>

            <main>
                <h2 id="question-text" class="text-xl sm:text-2xl font-semibold mb-6 h-24 sm:h-16"></h2>
                <div id="options-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                </div>
            </main>

            <div id="feedback-container" class="mt-6 p-4 rounded-lg bg-stone-100 border border-stone-200 hidden">
                <h3 id="feedback-title" class="font-bold text-lg mb-2"></h3>
                <p id="feedback-explanation" class="text-stone-600 mb-2"></p>
                <p id="feedback-justification" class="text-sm text-stone-500"></p>
            </div>

            <footer class="mt-8 flex justify-between items-center">
                <button id="back-to-home-button" class="px-4 py-2 bg-stone-200 text-stone-700 font-semibold rounded-lg shadow-md hover:bg-stone-300 focus:outline-none focus:ring-2 focus:ring-stone-400 focus:ring-opacity-75 transition-colors">
                    Back to Home
                </button>
                <button id="next-button" class="px-6 py-2 bg-teal-600 text-white font-semibold rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75 disabled:bg-stone-300 disabled:cursor-not-allowed transition-colors">
                    Next
                </button>
            </footer>
        </div>

        <div id="results-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg text-center transition-opacity duration-500 hidden">
            <h2 class="text-2xl sm:text-3xl font-bold text-stone-800 mb-2">Quiz Completed!</h2>
            <p class="text-stone-600 mb-6">Here's how you did.</p>
            
            <div class="chart-container mb-6">
                <canvas id="results-chart"></canvas>
            </div>
            
            <p id="score-text" class="text-xl font-semibold mb-8"></p>

            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button id="restart-button" class="w-full sm:w-auto px-8 py-3 bg-teal-600 text-white font-semibold rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75 transition-colors">
                    Restart Quiz
                </button>
            </div>
        </div>

    </div>

    <script>
        const quizSets = [
            // Quiz Set 1: Original Grammar Questions
            [
                { question: "Taking on too many responsibilities can lead to ________.", options: ["overwhelm", "overwhelmed", "overwhelming", "overwhelms"], correct: 2, explanation: "“Overwhelming” (adjective) describes something that causes a feeling of being overwhelmed.", justification: "a) “overwhelm” is a verb; b) “overwhelmed” is a past participle; d) “overwhelms” is a verb." },
                { question: "The committee’s decision was widely ________ in the local news.", options: ["reported", "reporter", "reporting", "reportage"], correct: 0, explanation: "“Reported” (past-participle) describes how the decision was presented.", justification: "b) “reporter” is a person; c) “reporting” is a noun; d) “reportage” is a formal noun." },
                { question: "The project will ________ several departments.", options: ["involve", "involved", "involvement", "involving"], correct: 0, explanation: "After “will” we use the base verb “involve.”", justification: "b) “involved” is the wrong tense; c) “involvement” is a noun; d) “involving” is a participle." },
                { question: "She has a very ________ memory and remembers facts easily.", options: ["photographic", "photography", "photographed", "photographs"], correct: 0, explanation: "“Photographic” (adjective) describes an exceptionally clear memory.", justification: "b) “photography” is a noun; c) “photographed” is a past-participle; d) “photographs” is a noun." },
                { question: "The teacher emphasised the ________ of punctuality.", options: ["importance", "important", "importantly", "import"], correct: 0, explanation: "“Importance” (noun) fits the structure “the … of punctuality.”", justification: "b) is an adjective; c) is an adverb; d) “import” is a less common noun here." },
                { question: "Many learners find phrasal verbs ________.", options: ["confusing", "confused", "confusion", "confuse"], correct: 0, explanation: "Phrasal verbs cause confusion, so the adjective “confusing” is correct.", justification: "b) “confused” describes a person; c) is a noun; d) is a verb." },
                { question: "His explanation was quite ________; I understood everything.", options: ["clarity", "clarify", "clear", "clearing"], correct: 2, explanation: "“Clear” (adjective) describes the explanation.", justification: "a) is a noun; b) is a verb; d) is a gerund/noun." },
                { question: "It’s essential to ________ new vocabulary frequently.", options: ["revise", "revision", "revising", "revised"], correct: 0, explanation: "After “to,” use the base verb “revise.”", justification: "b) is a noun; c) is a gerund; d) is a past participle." },
                { question: "She gained ________ from her reading practice.", options: ["confidence", "confident", "confidently", "confortable"], correct: 0, explanation: "“Confidence” (noun) is what she gains.", justification: "b) is an adjective; c) is an adverb; d) is a misspelling." },
                { question: "The exam questions were ________ than I expected.", options: ["more difficult", "most difficult", "difficultest", "difficult"], correct: 0, explanation: "The comparative form “more difficult” is needed for the comparison.", justification: "b) is superlative; c) is not a word; d) is not comparative." },
                { question: "He has the ________ to adapt lessons for diverse learners.", options: ["ability", "able", "abilitying", "ably"], correct: 0, explanation: "“Ability” (noun) fits the structure “has the … to adapt.”", justification: "b) is an adjective; c) is not a word; d) is an adverb." },
                { question: "They ________ the lesson plan before the class started.", options: ["finalised", "finalise", "finalising", "finale"], correct: 0, explanation: "The past-tense verb “finalised” is needed.", justification: "b) is present tense; c) is a gerund; d) is a noun." },
                { question: "His approach is highly ________ and effective.", options: ["practical", "practise", "practically", "practicable"], correct: 0, explanation: "“Practical” (adjective) describes the approach.", justification: "b) is a verb/noun; c) is an adverb; d) means possible but is less natural." },
                { question: "The teacher encouraged ________ learning among her students.", options: ["autonomous", "autonomy", "autonomously", "autonomise"], correct: 0, explanation: "“Autonomous learning” is a common collocation (adjective + noun).", justification: "b) is a noun; c) is an adverb; d) is a verb." },
                { question: "The deadline was suddenly ________ from Friday to Monday.", options: ["extended", "extending", "extents", "extent"], correct: 0, explanation: "“Extended” is the past participle used in this passive construction.", justification: "b) is progressive; c) is a plural noun; d) is a noun." },
                { question: "Students should practise ________ new words in sentence context.", options: ["using", "used", "use", "uses"], correct: 0, explanation: "The gerund “using” is required after the verb “practise.”", justification: "b) is an adjective; c) is a base verb; d) is a third-person singular verb." },
                { question: "He achieved a high level of ________ in spoken English.", options: ["proficiency", "proficient", "proficiently", "proficiate"], correct: 0, explanation: "“Proficiency” is the noun required to express a level of ability.", justification: "b) is an adjective; c) is an adverb; d) is not a word." },
                { question: "We must ensure consistent ________ across all exams.", options: ["marking", "marked", "mark", "marker"], correct: 0, explanation: "“Marking” (noun/gerund) refers to the process of grading.", justification: "b) is an adjective; c) is a verb/noun; d) is a tool/person." },
                { question: "Her feedback was very ________.", options: ["constructive", "construction", "constructively", "constructs"], correct: 0, explanation: "“Constructive feedback” is a very common and natural collocation.", justification: "b) is a noun; c) is an adverb; d) is a noun/verb." },
                { question: "Many students found the grammar explanation ________.", options: ["helpful", "helpless", "helpfully", "helping"], correct: 0, explanation: "“Helpful” (adjective) is used to describe the explanation.", justification: "b) has the opposite meaning; c) is an adverb; d) is a gerund/participle." }
            ],
            // Quiz Set 2:
            [
                { question: "The new curriculum aims to __________ students' critical thinking skills.", options: ["enhance", "amplify", "magnify", "extend"], correct: 0, explanation: "'Enhance' means to improve the quality, value, or extent of something. In this context, it refers to improving critical thinking skills.", justification: "'Amplify' means to increase the volume or intensity. 'Magnify' means to make something appear larger than it is. 'Extend' means to make something longer or larger in area. None of these fit the context of improving skills as precisely as 'enhance'." },
                { question: "It's __________ that students participate actively in class discussions to foster a dynamic learning environment.", options: ["imperative", "optional", "trivial", "secondary"], correct: 0, explanation: "'Imperative' means of vital importance; crucial. Active participation is crucial for a dynamic learning environment.", justification: "'Optional' means available as a choice. 'Trivial' means of little value or importance. 'Secondary' means less important than something else. These do not convey the necessary importance." },
                { question: "Despite facing numerous challenges, she remained __________ in her pursuit of higher education.", options: ["hesitant", "resolute", "fragile", "wavering"], correct: 1, explanation: "'Resolute' means admirably purposeful, determined, and unwavering. It describes someone who is firm in their decision or purpose.", justification: "'Hesitant' means tentative, unsure, or slow in acting or speaking. 'Fragile' means easily broken or damaged. 'Wavering' means to be undecided or to fluctuate. These words are antonyms or do not fit the context of determination." },
                { question: "The teacher tried to __________ the complex concept by using simple analogies.", options: ["obfuscate", "elucidate", "complicate", "bewilder"], correct: 1, explanation: "'Elucidate' means to make (something) clear; explain. The teacher's goal was to clarify the concept.", justification: "'Obfuscate' means to make obscure, unclear, or unintelligible. 'Complicate' means to make something more difficult or complex. 'Bewilder' means to cause someone to become perplexed and confused. These are the opposite of the intended meaning." },
                { question: "His __________ for teaching was evident in the way he inspired his students.", options: ["apathy", "indifference", "passion", "reluctance"], correct: 2, explanation: "'Passion' refers to a strong and barely controllable emotion, or an intense enthusiasm for something. In this case, it's a strong enthusiasm for teaching.", justification: "'Apathy' means a lack of interest, enthusiasm, or concern. 'Indifference' is a lack of interest, concern, or sympathy. 'Reluctance' means unwillingness or disinclination. These words describe a lack of positive feeling towards teaching." },
                { question: "The school encourages students to __________ in extracurricular activities to develop a well-rounded personality.", options: ["abstain", "refrain", "partake", "deter"], correct: 2, explanation: "'Partake' means to take part in (an activity). It fits the context of participating in activities.", justification: "'Abstain' means to restrain oneself from doing or enjoying something. 'Refrain' means to stop oneself from doing something. 'Deter' means to discourage someone from doing something. These words suggest avoiding or preventing participation." },
                { question: "It is important to __________ cultural differences when teaching English to non-native speakers.", options: ["disregard", "acknowledge", "ignore", "dismiss"], correct: 1, explanation: "'Acknowledge' means to accept or admit the existence or truth of. Recognizing cultural differences is crucial for effective teaching.", justification: "'Disregard' means to pay no attention to; ignore. 'Ignore' means to intentionally not take notice of or consider. 'Dismiss' means to treat something as unworthy of serious consideration. These words suggest not considering cultural differences." },
                { question: "The principal gave a __________ speech about the importance of perseverance in academic life.", options: ["tedious", "monotonous", "stirring", "dull"], correct: 2, explanation: "'Stirring' means arousing strong emotion or excitement. A speech that inspires perseverance would be stirring.", justification: "'Tedious' means too long, slow, or dull; tiresome or monotonous. 'Monotonous' means dull, tedious, and repetitious. 'Dull' means lacking interest or excitement. These words describe a boring speech." },
                { question: "Effective communication requires the ability to __________ your thoughts clearly and concisely.", options: ["mumble", "articulate", "stammer", "whisper"], correct: 1, explanation: "'Articulate' means to express (an idea or feeling) fluently and coherently. This is essential for clear communication.", justification: "'Mumble' means to say something indistinctly and quietly. 'Stammer' means to speak with sudden involuntary pauses and a tendency to repeat the initial letters of words. 'Whisper' means to speak very softly using one's breath rather than one's vocal cords. These describe unclear or quiet speaking." },
                { question: "The teacher's __________ approach to grammar made the lessons engaging and easy to understand.", options: ["rigid", "dogmatic", "innovative", "conventional"], correct: 2, explanation: "'Innovative' means featuring new methods; advanced and original. An innovative approach would make lessons engaging and easy to understand.", justification: "'Rigid' means unable to bend or be forced out of shape; not flexible. 'Dogmatic' means inclined to lay down principles as undeniably true. 'Conventional' means based on or in accordance with what is generally accepted or believed. These words suggest a less flexible or less engaging approach." },
                { question: "Students are encouraged to __________ their own learning by setting personal goals.", options: ["relinquish", "undermine", "take charge of", "neglect"], correct: 2, explanation: "'Take charge of' is a phrasal verb meaning to take control or responsibility for something. This encourages students to be responsible for their learning.", justification: "'Relinquish' means voluntarily cease to keep or claim; give up. 'Undermine' means to damage or weaken (someone or something), especially gradually or insidiously. 'Neglect' means to fail to care for properly. These are the opposite of taking responsibility." },
                { question: "The university offers a wide __________ of courses in various disciplines.", options: ["narrow", "limited", "array", "scarce"], correct: 2, explanation: "'Array' means an impressive display or range of a particular type of thing. It fits the context of a wide selection of courses.", justification: "'Narrow' means of small width in relation to length. 'Limited' means restricted in size, amount, or extent. 'Scarce' means (especially of food, money, or some other resource) insufficient for the demand. These words imply a small or insufficient selection." },
                { question: "It is important for teachers to provide __________ feedback to students to help them improve.", options: ["vague", "constructive", "ambiguous", "general"], correct: 1, explanation: "'Constructive' means serving a useful purpose; tending to build up. Constructive feedback helps students improve.", justification: "'Vague' means of uncertain, indefinite, or unclear character or meaning. 'Ambiguous' means open to more than one interpretation; having a double meaning. 'General' means affecting or concerning all or most people, places, or things; not specific. These types of feedback would not be helpful for improvement." },
                { question: "The school has a strict policy against __________ in exams.", options: ["integrity", "honesty", "plagiarism", "originality"], correct: 2, explanation: "'Plagiarism' is the practice of taking someone else's work or ideas and passing them off as one's own. It is a common issue in academic settings that schools have policies against.", justification: "'Integrity' means the quality of being honest and having strong moral principles. 'Honesty' is the quality of being truthful and upright. 'Originality' is the quality of being new and inventive. These are positive attributes, not something a school would have a policy against." },
                { question: "Learning a new language can be a challenging but ultimately __________ experience.", options: ["futile", "unrewarding", "gratifying", "pointless"], correct: 2, explanation: "'Gratifying' means pleasing or satisfying. A challenging experience that leads to positive results would be gratifying.", justification: "'Futile' means incapable of producing any useful result; pointless. 'Unrewarding' means not providing satisfaction or benefit. 'Pointless' means having no purpose or meaning. These words suggest a negative or useless experience." },
                { question: "The teacher decided to __________ the lesson with a fun, interactive activity.", options: ["conclude", "commence", "introduce", "prolong"], correct: 0, explanation: "'Conclude' means to bring (something) to an end. Ending a lesson with an activity is a common practice.", justification: "'Commence' means to begin. 'Introduce' means to bring (something) into use or operation for the first time. 'Prolong' means to extend the duration of. These words do not fit the context of ending a lesson." },
                { question: "Students should be encouraged to __________ their opinions respectfully, even if they differ from others.", options: ["suppress", "stifle", "express", "conceal"], correct: 2, explanation: "'Express' means to convey (a thought or feeling) in words or by gestures and conduct. Encouraging students to share their opinions is important.", justification: "'Suppress' means forcibly put an end to. 'Stifle' means to prevent or constrain (an activity or idea). 'Conceal' means to keep from sight; hide. These words imply preventing the sharing of opinions." },
                { question: "The new teaching methodology proved to be highly __________ in improving student performance.", options: ["ineffective", "detrimental", "efficacious", "useless"], correct: 2, explanation: "'Efficacious' means (typically of something inanimate or abstract) successful in producing a desired or intended result; effective. It describes something that works well.", justification: "'Ineffective' means not producing any or the desired effect. 'Detrimental' means tending to cause harm. 'Useless' means not fulfilling a purpose or need. These words suggest a negative or unproductive outcome." },
                { question: "It is essential to __________ a positive learning environment in the classroom.", options: ["dismantle", "cultivate", "demolish", "eradicate"], correct: 1, explanation: "'Cultivate' means to try to acquire or develop (a quality, sentiment, or skill). In this context, it means to foster and develop a positive environment.", justification: "'Dismantle' means to take (a machine or structure) to pieces. 'Demolish' means to pull or knock down (a building). 'Eradicate' means to destroy completely; put an end to. These words are the opposite of building or fostering something positive." },
                { question: "The teacher's clear instructions helped to __________ any confusion among the students.", options: ["exacerbate", "alleviate", "intensify", "complicate"], correct: 1, explanation: "'Alleviate' means to make (suffering, deficiency, or a problem) less severe. Clear instructions would reduce confusion.", justification: "'Exacerbate' means to make (a problem, bad situation, or negative feeling) worse. 'Intensify' means to become or make more intense. 'Complicate' means to make (something) more difficult or complex. These words suggest making the confusion worse." }
            ],
            // Quiz Set 3: Placeholder Questions
            [
                { question: "This is a placeholder question for Quiz Set 3. Which planet is known as the Red Planet?", options: ["Earth", "Mars", "Jupiter", "Venus"], correct: 1, explanation: "Mars is commonly referred to as the Red Planet due to its iron oxide-rich surface.", justification: "Common astronomical fact." }
            ],
            // Quiz Set 4: Placeholder Questions
            [
                { question: "This is a placeholder question for Quiz Set 4. What is the capital of France?", options: ["London", "Berlin", "Paris", "Rome"], correct: 2, explanation: "Paris is the capital city of France.", justification: "Geographical fact." }
            ],
            // Quiz Set 5: Placeholder Questions
            [
                { question: "This is a placeholder question for Quiz Set 5. Which of these is a primary color?", options: ["Green", "Orange", "Purple", "Blue"], correct: 3, explanation: "Blue is considered a primary color in the subtractive color model.", justification: "Color theory." }
            ],
            // Quiz Set 6: Placeholder Questions
            [
                { question: "This is a placeholder question for Quiz Set 6. Which of these is NOT a real animal?", options: ["Griffen", "Lion", "Spider", "Cheetah"], correct: 0, explanation: "Griffen is a legandary half eagle half, half lion.", justification: "The other are all real animals." }
            ]
        ];

        let currentQuizSetIndex = 0;
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let chartInstance = null;

        const homePageContainer = document.getElementById('home-page-container');
        const quizSetButtonsContainer = document.getElementById('quiz-set-buttons');
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');

        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const feedbackContainerEl = document.getElementById('feedback-container');
        const feedbackTitleEl = document.getElementById('feedback-title');
        const feedbackExplanationEl = document.getElementById('feedback-explanation');
        const feedbackJustificationEl = document.getElementById('feedback-justification');
        const nextButton = document.getElementById('next-button');
        const backToHomeButton = document.getElementById('back-to-home-button');
        const progressTextEl = document.getElementById('progress-text');
        const progressBarEl = document.getElementById('progress-bar');
        const scoreTextEl = document.getElementById('score-text');
        const restartButton = document.getElementById('restart-button');

        function showHomePage() {
            homePageContainer.classList.remove('hidden');
            quizContainer.classList.add('hidden');
            resultsContainer.classList.add('hidden');
            renderQuizSetButtons();
        }

        function renderQuizSetButtons() {
            quizSetButtonsContainer.innerHTML = '';
            quizSets.forEach((set, index) => {
                const button = document.createElement('button');
                button.textContent = `Quiz Set ${index + 1}`;
                button.classList.add('w-full', 'p-6', 'bg-teal-500', 'text-white', 'font-semibold', 'rounded-lg', 'shadow-md', 'hover:bg-teal-600', 'focus:outline-none', 'focus:ring-2', 'focus:ring-teal-500', 'focus:ring-opacity-75', 'transition-colors', 'text-lg');
                button.addEventListener('click', () => startQuiz(index));
                quizSetButtonsContainer.appendChild(button);
            });
        }

        function startQuiz(setIndex) {
            currentQuizSetIndex = setIndex;
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = new Array(quizSets[currentQuizSetIndex].length).fill(null);
            
            homePageContainer.classList.add('hidden');
            resultsContainer.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            resetState();
            const currentQuestion = quizSets[currentQuizSetIndex][currentQuestionIndex];
            questionTextEl.textContent = currentQuestion.question.replace('________', '________');
            
            currentQuestion.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('w-full', 'p-4', 'border-2', 'border-stone-300', 'rounded-lg', 'text-left', 'hover:bg-stone-100', 'hover:border-teal-400', 'transition-colors', 'duration-200', 'focus:outline-none', 'focus:ring-2', 'focus:ring-teal-500');
                button.dataset.index = index;
                button.addEventListener('click', () => selectAnswer(index));
                optionsContainerEl.appendChild(button);
            });

            updateProgress();
        }

        function resetState() {
            optionsContainerEl.innerHTML = '';
            feedbackContainerEl.classList.add('hidden');
            nextButton.disabled = true;
        }

        function selectAnswer(selectedIndex) {
            const currentQuestion = quizSets[currentQuizSetIndex][currentQuestionIndex];
            const isCorrect = selectedIndex === currentQuestion.correct;
            userAnswers[currentQuestionIndex] = selectedIndex;

            if (isCorrect) {
                score++;
                feedbackTitleEl.textContent = 'Correct!';
                feedbackTitleEl.classList.remove('text-red-600');
                feedbackTitleEl.classList.add('text-green-600');
            } else {
                feedbackTitleEl.textContent = 'Incorrect';
                feedbackTitleEl.classList.remove('text-green-600');
                feedbackTitleEl.classList.add('text-red-600');
            }

            feedbackExplanationEl.textContent = currentQuestion.explanation;
            feedbackJustificationEl.textContent = `Justification: ${currentQuestion.justification}`;
            feedbackContainerEl.classList.remove('hidden');

            Array.from(optionsContainerEl.children).forEach(button => {
                button.disabled = true;
                const buttonIndex = parseInt(button.dataset.index);

                if (buttonIndex === currentQuestion.correct) {
                    button.classList.remove('border-stone-300', 'hover:bg-stone-100');
                    button.classList.add('bg-green-100', 'border-green-500', 'font-semibold');
                } else if (buttonIndex === selectedIndex) {
                    button.classList.remove('border-stone-300', 'hover:bg-stone-100');
                    button.classList.add('bg-red-100', 'border-red-500');
                }
            });

            nextButton.disabled = false;
        }

        function updateProgress() {
            const totalQuestionsInSet = quizSets[currentQuizSetIndex].length;
            const progressPercentage = ((currentQuestionIndex + 1) / totalQuestionsInSet) * 100;
            progressTextEl.textContent = `Question ${currentQuestionIndex + 1} / ${totalQuestionsInSet}`;
            progressBarEl.style.width = `${progressPercentage}%`;
        }

        function showResults() {
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            scoreTextEl.textContent = `You scored ${score} out of ${quizSets[currentQuizSetIndex].length}.`;
            renderResultsChart();
        }
        
        function renderResultsChart() {
            const ctx = document.getElementById('results-chart').getContext('2d');
            if (chartInstance) {
                chartInstance.destroy();
            }
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Correct', 'Incorrect'],
                    datasets: [{
                        data: [score, quizSets[currentQuizSetIndex].length - score],
                        backgroundColor: ['#14b8a6', '#fca5a5'],
                        borderColor: ['#0f766e', '#ef4444'],
                        borderWidth: 2,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            enabled: true
                        }
                    }
                }
            });
        }

        nextButton.addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizSets[currentQuizSetIndex].length) {
                showQuestion();
            } else {
                showResults();
            }
        });

        backToHomeButton.addEventListener('click', showHomePage);
        restartButton.addEventListener('click', showHomePage);

        document.addEventListener('DOMContentLoaded', showHomePage);
    </script>
</body>
</html>
